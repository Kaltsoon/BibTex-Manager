var FILTER_MODULE=function(){var e=function(e,t){return t.toLowerCase().indexOf(e.toLowerCase())>=0},t=function(e,t){return t.toLowerCase().indexOf(e.toLowerCase())>=0},r=function(e,t){for(var r=0;r<t.length;r++)if(attribute=t[r],attribute.value.toLowerCase().indexOf(e.toLowerCase())>=0)return!0;return!1},o=function(o,n){return r(o,n.reference_attributes)||t(o,n.ref_type)||e(o,n.name)},n=function(e,t){for(var r=0;r<e.length;r++)if(word=e[r].replace(/'/g,""),!o(word,t))return!1;return!0},i=function(e,t){return e.toLowerCase().indexOf("' and '")>=0?(keywords=e.toLowerCase().split("' and '"),n(keywords,t)):o(e.replace(/'/g,""),t)};return{matches:i}}(),REFERENCE_LIST_MODULE=function(e){var t=[],r=[],o=function(e){$.getJSON("/references.json",function(o){t=o,r=t,e()})},n=function(){var o=$("#filter-keyword").val().toLowerCase();if(r=[],o)for(var n=0;n<t.length;n++)ref=t[n],e.matches(o,ref)&&r.push(ref);else r=t;a()},i=function(){$(".reference-attributes-popover").popover({trigger:"manual",html:!0}).on("mouseenter",function(){var e=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(e).popover("hide")})}).on("mouseleave",function(){var e=this;setTimeout(function(){$(".popover:hover").length||$(e).popover("hide")},100)}),$(".reference-bibtex-popover").popover({trigger:"manual",html:!0}).on("mouseenter",function(){var e=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(e).popover("hide")})}).on("mouseleave",function(){var e=this;setTimeout(function(){$(".popover:hover").length||$(e).popover("hide")},100)}),$("a[rel=popover]").on("mouseover",function(){$("a[rel=popover]").not(this).popover("hide")})},a=function(){$("#download-filtered-references").removeAttr("disabled"),0==r.length&&$("#download-filtered-references").attr("disabled","disabled"),r.forEach(function(e){attributes=[],e.reference_attributes.forEach(function(e){"author"==e.name||"editor"==e.name?attributes[0]=e:"title"==e.name?attributes[1]=e:"year"==e.name&&(attributes[2]=e)}),e.displayed_attributes=attributes}),$("#reference-list").html(Mustache.to_html($("#reference-row-template").html(),{references:r})),i()},u=function(){o(a)};return{list:u,filter:n}}(FILTER_MODULE);$(document).on("ready",function(){REFERENCE_LIST_MODULE.list(),$("#filter-keyword").keyup(function(){REFERENCE_LIST_MODULE.filter()})});